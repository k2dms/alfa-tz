- name: Ensure user '{{ test_user }}' exists with specific UID
  user:
    name: "{{ test_user }}"
    uid: "{{ test_uid }}"
    comment: "Test user"
    shell: /bin/bash
    create_home: yes
    state: present

- name: Ensure /data directory exists
  file:
    path: "{{ data_mount }}"
    state: directory
    owner: "{{ test_user }}"
    group: "{{ test_user }}"
    mode: '0755'

- name: Create sudoers file for useradd permission
  copy:
    dest: /etc/sudoers.d/90_test_useradd
    content: "{{ test_user }} ALL=(root) NOPASSWD: /usr/sbin/useradd\n"
    mode: '0440'

- name: Update all packages (dnf)
  dnf:
    name: "*"
    state: latest
    update_cache: yes

